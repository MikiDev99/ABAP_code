*&---------------------------------------------------------------------*
*& Include          ZMIGR_CONTROLLA_FILE_TOP
*&---------------------------------------------------------------------*

TYPES: BEGIN OF ty_file,
         dato TYPE string,
       END OF ty_file,

       BEGIN OF ty_scarto,
*         sorgente    TYPE string,
         ref_chiave  TYPE string,
         chiave_ecc  TYPE string,
         chiave_s4   TYPE string,
         count       TYPE string,
         ref_delta   TYPE string,
*         delta       TYPE string,
         descrizione TYPE string,
       END OF ty_scarto,

       BEGIN OF ty_bp,
         partner     TYPE but000-partner,
         type        TYPE but000-type,
         name_last   TYPE but000-name_last,
         name_first  TYPE but000-name_first,
         piva_gruppo TYPE dfkkbptaxnum-taxnum,
         it0         TYPE dfkkbptaxnum-taxnum,
         it1         TYPE dfkkbptaxnum-taxnum,
       END OF ty_bp,

       BEGIN OF ty_contract,
         vertrag         TYPE ever-vertrag,
         invoicing_party TYPE ever-invoicing_party,
         vkonto          TYPE ever-vkonto,
         serviceid       TYPE ever-serviceid,
         bukrs           TYPE ever-bukrs,
         einzdat         TYPE ever-einzdat,
         auszdat         TYPE ever-auszdat,
         anlage          TYPE ever-anlage,
         ausgrup         TYPE ever-ausgrup,
         ext_ui          TYPE euitrans-ext_ui,
         zzgdclasr3      TYPE ever-zzgdclasr3,
         portion         TYPE ever-portion,
         zzgdtipoute     TYPE ever-zzgdtipoute,
       END OF ty_contract,

       BEGIN OF ty_billdoc,
         vertrag    TYPE erch-vertrag,
         gpartner   TYPE erch-gpartner,
         ext_ui     TYPE euitrans-ext_ui,
         belnr      TYPE erch-belnr,
         belzart    TYPE dberchz1-belzart,
         ab         TYPE dberchz1-ab,
         bis        TYPE dberchz1-bis,
         buchrel    TYPE dberchz1-buchrel,
         nettobtr   TYPE char13,
         einzdat    TYPE ever-einzdat,
         endabrpe   TYPE erch-endabrpe,
         sparte     TYPE erch-sparte,
         begabrpe   TYPE erch-begabrpe,
         abrvorg    TYPE erch-abrvorg,
         actperiod  TYPE erch-actperiod,
         portion    TYPE ever-portion,
         zzgdclasr3 TYPE ever-zzgdclasr3,
         adatsoll   TYPE eablg-adatsoll,
       END OF ty_billdoc,

       BEGIN OF ty_meterread,
         ext_ui     TYPE euitrans-ext_ui,
         geraet     TYPE eabl-gernr,
         adat       TYPE eabl-adat,
         zwnummer   TYPE eabl-zwnummer,
         v_zwstand  TYPE eabl-v_zwstand,
         n_zwstand  TYPE eabl-n_zwstand,
         anlage     TYPE eanl-anlage,
         istablart  TYPE eabl-istablart,
         ablestyp   TYPE eabl-ablestyp,
         zzgdcodimp TYPE eanl-zzgdcodimp,
         zzgdclasr3 TYPE eanl-zzgdclasr3,
       END OF ty_meterread,

       BEGIN OF ty_operand,
         anlage   TYPE eanl-anlage,
         operand  TYPE ettifn-operand,
         ablfdnr  TYPE ettifn-ablfdnr,
         ab       TYPE ettifn-ab,
         bis      TYPE ettifn-bis,
         string1  TYPE ettifn-string1,
         string2  TYPE ettifn-string2,
         string3  TYPE ettifn-string3,
         string4  TYPE ettifn-string4,
         wert1    TYPE ettifn-wert1,
         wert2    TYPE ettifn-wert2,
         inaktiv  TYPE ettifn-inaktiv,
         betrag   TYPE ettifn-betrag,
         waers    TYPE ettifn-waers,
         tarifart TYPE ettifn-tarifart,
         kondigr  TYPE ettifn-kondigr,
       END OF ty_operand.

DATA: gv_active_rb   TYPE char1,
      gv_file_struct TYPE string,
      gv_file_key    TYPE string.

DATA: gv_key1 TYPE string,
      gv_key2 TYPE string,
      gv_key3 TYPE string,
      gv_key4 TYPE string.

DATA gt_ordtab TYPE abap_sortorder_tab.

FIELD-SYMBOLS: <t_ecc> TYPE STANDARD TABLE,
               <t_s4>  TYPE STANDARD TABLE.

DATA: gs_file_ext    TYPE REF TO data,
      go_structdescr TYPE REF TO cl_abap_structdescr.

DATA: gt_ecc             TYPE TABLE OF ty_file,
      gt_s4              TYPE TABLE OF ty_file,
      gt_file_scarti_ecc TYPE TABLE OF ty_file,
      gt_file_scarti_s4  TYPE TABLE OF ty_file,
      gt_ecc_ext         TYPE REF TO data,
      gt_s4_ext          TYPE REF TO data,
      gt_file_scarti     TYPE TABLE OF ty_scarto,
      gt_csv             TYPE TABLE OF string.